<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: head}"></th:block>
    <link rel="stylesheet" th:href="@{/css/admin-style.css}">
    <style>
        /* Hiệu ứng nổi lên khi di chuột vào Card */
        .studio-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .studio-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.08) !important;
        }

        /* Badge mềm cho loại phòng */
        .badge-soft-vocal { background-color: #e3f2fd; color: #0d47a1; }
        .badge-soft-band  { background-color: #fff8e1; color: #f57f17; }
        .badge-soft-mixing{ background-color: #f3e5f5; color: #7b1fa2; }

        /* Hiệu ứng ảnh */
        .card-img-top {
            transition: opacity 0.3s;
        }
        .studio-card:hover .card-img-top {
            opacity: 0.9;
        }
    </style>
</head>
<body class="bg-light">

<div class="container-fluid">
    <div class="row">
        <div th:replace="~{fragments/sidebar :: sidebar('studios')}"></div>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 border-bottom pb-3 gap-3">
                <div>
                    <h2 class="fw-bold text-dark mb-1">
                        <i class="bi bi-mic-fill me-2 text-primary"></i>Quản lý Phòng Thu
                    </h2>
                    <p class="text-muted mb-0 small">Danh sách các phòng thu âm và tập luyện hiện có.</p>
                </div>

                <a th:href="@{/admin/studio/new}" class="btn btn-primary d-flex align-items-center shadow-sm fw-bold px-4 rounded-pill">
                    <i class="bi bi-plus-lg me-2"></i> Thêm phòng mới
                </a>
            </div>

            <div th:if="${message}" class="alert alert-success alert-dismissible fade show shadow-sm border-0 border-start border-success border-4 rounded-3">
                <i class="bi bi-check-circle-fill me-2"></i><span th:text="${message}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show shadow-sm border-0 border-start border-danger border-4 rounded-3">
                <i class="bi bi-exclamation-triangle-fill me-2"></i><span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <div th:if="${studios.empty}" class="text-center py-5">
                <div class="bg-white p-5 rounded-4 shadow-sm d-inline-block">
                    <i class="bi bi-mic-mute fs-1 text-muted opacity-25 mb-3 d-block"></i>
                    <h5 class="fw-bold text-secondary">Chưa có phòng thu nào</h5>
                    <p class="text-muted small mb-4">Hệ thống chưa ghi nhận phòng thu nào. Hãy bắt đầu ngay!</p>
                    <a th:href="@{/admin/studio/new}" class="btn btn-primary rounded-pill px-4">Thêm phòng ngay</a>
                </div>
            </div>

            <div class="row g-4" th:unless="${studios.empty}">
                <div class="col-md-6 col-lg-4 col-xl-3" th:each="studio : ${studios}">
                    <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden studio-card bg-white">

                        <div class="position-relative">
                            <img th:if="${studio.imageUrl}" th:src="${studio.imageUrl}"
                                 class="card-img-top" style="height: 200px; object-fit: cover;">

                            <div th:unless="${studio.imageUrl}" class="card-img-top bg-light d-flex align-items-center justify-content-center text-muted" style="height: 200px;">
                                <i class="bi bi-image fs-1 opacity-25"></i>
                            </div>

                            <div class="position-absolute top-0 end-0 m-3">
                                <th:block th:switch="${studio.studioType}">
                                    <span th:case="'VOCAL'" class="badge badge-soft-vocal shadow-sm rounded-pill px-3 py-2">VOCAL</span>
                                    <span th:case="'BAND'" class="badge badge-soft-band shadow-sm rounded-pill px-3 py-2">BAND</span>
                                    <span th:case="'MIXING'" class="badge badge-soft-mixing shadow-sm rounded-pill px-3 py-2">MIXING</span>
                                    <span th:case="*" class="badge bg-light text-dark border shadow-sm rounded-pill px-3 py-2" th:text="${studio.studioType}">TYPE</span>
                                </th:block>
                            </div>
                        </div>

                        <div class="card-body d-flex flex-column p-4">
                            <h5 class="card-title fw-bold text-dark mb-2 text-truncate" th:text="${studio.name}" th:title="${studio.name}">
                                Tên phòng
                            </h5>

                            <p class="card-text text-muted small mb-3 flex-grow-1"
                               style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"
                               th:text="${studio.description}">
                                Mô tả chi tiết...
                            </p>

                            <div class="d-flex justify-content-between align-items-end pt-3 border-top border-light">
                                <div>
                                    <small class="text-muted d-block" style="font-size: 0.75rem;">Đơn giá:</small>
                                    <span class="text-primary fw-bold fs-5">
                                        <span th:text="${#numbers.formatDecimal(studio.pricePerHour, 0, 'POINT', 0, 'COMMA')}"></span>
                                        <small class="fs-6 text-muted fw-normal">₫/h</small>
                                    </span>
                                </div>

                                <div th:if="${studio.demos != null and !studio.demos.empty}" class="text-muted small" title="Số bản Demo">
                                    <i class="bi bi-music-note-list me-1"></i><span th:text="${studio.demos.size()}"></span>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer bg-white border-0 p-3 pt-0">
                            <div class="d-flex gap-2">
                                <a th:href="@{/admin/studio/edit/{id}(id=${studio.id})}"
                                   class="btn btn-sm btn-light flex-fill fw-bold text-primary hover-shadow border">
                                    <i class="bi bi-pencil-square me-1"></i> Sửa
                                </a>
                                <a th:href="@{/admin/studio/delete/{id}(id=${studio.id})}"
                                   class="btn btn-sm btn-light flex-fill fw-bold text-danger hover-shadow border"
                                   onclick="return confirm('CẢNH BÁO: Bạn có chắc chắn muốn xóa phòng này? Các đơn đặt lịch liên quan cũng sẽ bị ảnh hưởng!')">
                                    <i class="bi bi-trash me-1"></i> Xóa
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-center mt-5" th:if="${totalPages > 1}">
                <nav>
                    <ul class="pagination shadow-sm">
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link border-0 rounded-start" th:href="@{/admin/studios(page=${currentPage - 1})}">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>

                        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link border-0 mx-1 rounded" th:href="@{/admin/studios(page=${i})}" th:text="${i + 1}">1</a>
                        </li>

                        <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                            <a class="page-link border-0 rounded-end" th:href="@{/admin/studios(page=${currentPage + 1})}">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

        </main>
    </div>
</div>

<th:block th:replace="~{fragments/footer :: footer}"></th:block>

</body>
</html>