<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Trang chủ | NAT Studio</title>
    <th:block th:replace="~{fragments/head :: head}"></th:block>

    <style>
        /* 1. HERO SECTION CAO CẤP */
        .hero-section {
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.7)),
                        url('https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&w=1600&q=90');
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Hiệu ứng Parallax nhẹ */
            padding: 120px 0;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
        }

        /* Hiệu ứng mờ ảo phía sau thanh tìm kiếm */
        .search-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50rem;
            padding: 8px;
            max-width: 750px;
            margin: 0 auto;
        }

        /* 2. STUDIO CARD TINH TẾ */
        .studio-card {
            border: none;
            border-radius: 20px;
            background: #fff;
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .studio-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
        }

        .card-img-wrapper {
            height: 230px;
            overflow: hidden;
            border-radius: 20px 20px 0 0;
            position: relative;
        }

        .card-img-top {
            transition: transform 0.8s ease;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .studio-card:hover .card-img-top {
            transform: scale(1.1);
        }

        /* Badge loại phòng */
        .type-badge {
            background: rgba(13, 110, 253, 0.9);
            backdrop-filter: blur(4px);
            font-size: 0.7rem;
            letter-spacing: 1px;
            padding: 6px 14px;
        }

        /* Giá tiền chuyên nghiệp */
        .price-tag {
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.5px;
            color: #059669; /* Success green */
        }

        /* 3. SECTION SERVICES */
        .service-box {
            border-radius: 24px;
            transition: var(--transition);
            border: 1px solid transparent;
        }
        .service-box:hover {
            background: #fff !important;
            border-color: #e2e8f0;
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
<div layout:fragment="content">

    <div class="container mt-4">
        <div class="hero-section text-white text-center shadow-lg mb-5 animate__animated animate__fadeIn">
            <div class="container py-4">
                <span class="badge bg-primary px-3 py-2 rounded-pill mb-3 animate__animated animate__fadeInDown">
                    <i class="bi bi-patch-check-fill me-1"></i> Best Recording Studio in Town
                </span>
                <h1 class="display-2 fw-extrabold mb-3 animate__animated animate__fadeInDown" style="letter-spacing: -2px;">NAT <span class="text-primary">STUDIO</span></h1>
                <p class="lead mb-5 opacity-75 fs-4 animate__animated animate__fadeInUp">Nơi những bản Hit ra đời - Hệ thống phòng thu âm chuẩn quốc tế</p>

                <form th:action="@{/home}" method="get" class="search-glass animate__animated animate__fadeInUp">
                    <div class="input-group">
                        <span class="input-group-text bg-transparent border-0 text-white opacity-50 ps-4">
                            <i class="bi bi-search fs-5"></i>
                        </span>
                        <input type="text" name="keyword" class="form-control bg-transparent border-0 text-white placeholder-white py-3 fs-5 shadow-none"
                               th:value="${keyword}"
                               placeholder="Tìm phòng (Band, Vocal, Podcast...)">
                        <button class="btn btn-primary rounded-pill px-5 fw-bold shadow-sm" type="submit">
                            Tìm kiếm
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h3 class="fw-extrabold text-dark mb-1 text-uppercase">
                    <i class="bi bi-mic-fill text-primary me-2"></i>Phòng thu nổi bật
                </h3>
                <p class="text-muted small mb-0">Lựa chọn không gian phù hợp với cá tính âm nhạc của bạn</p>
            </div>

            <div th:if="${studioPage != null}" class="d-none d-md-block">
                <div class="bg-white px-3 py-2 rounded-pill border shadow-sm">
                    <span class="text-muted small">Hiện có: </span>
                    <strong class="text-primary" th:text="${studioPage.totalElements}">0</strong>
                    <span class="text-muted small"> phòng sẵn sàng</span>
                </div>
            </div>
        </div>

        <div th:if="${studios == null || studios.empty}" class="text-center py-5 bg-white rounded-5 shadow-sm border border-dashed animate__animated animate__pulse">
            <div class="bg-light d-inline-block p-4 rounded-circle mb-4 text-muted">
                <i class="bi bi-search-heart display-4"></i>
            </div>
            <h4 class="text-dark fw-bold">Rất tiếc, không tìm thấy kết quả!</h4>
            <p class="text-muted mb-4">Bạn hãy thử từ khóa khác hoặc quay lại danh sách đầy đủ nhé.</p>
            <a th:href="@{/home}" class="btn btn-primary rounded-pill px-5 py-2 shadow">
                <i class="bi bi-arrow-clockwise me-1"></i> Hiển thị tất cả
            </a>
        </div>

        <div class="row g-4">
            <div class="col-md-6 col-lg-4" th:each="studio : ${studios}">
                <div class="card h-100 studio-card">
                    <div class="card-img-wrapper">
                        <span class="position-absolute top-0 end-0 m-3 badge rounded-pill type-badge shadow-sm z-3"
                              th:text="${studio.studioType}">TYPE</span>

                        <img th:src="${studio.imageUrl != null && studio.imageUrl != '' ? studio.imageUrl : 'https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?auto=format&fit=crop&w=800&q=80'}"
                             class="card-img-top" th:alt="${studio.name}"
                             onerror="this.src='https://placehold.co/800x600?text=Studio+Image'">
                    </div>

                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title fw-bold text-dark text-truncate mb-0" th:text="${studio.name}">Studio Name</h5>
                            <div class="small text-warning flex-shrink-0">
                                <i class="bi bi-star-fill"></i> <span class="text-muted fw-bold">4.9</span>
                            </div>
                        </div>

                        <p class="card-text text-muted small mb-4"
                           style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; min-height: 40px;"
                           th:text="${studio.description}"></p>

                        <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                            <span class="text-muted small fw-medium"><i class="bi bi-geo-alt me-1"></i>Hà Nội</span>
                            <h4 class="price-tag fw-extrabold mb-0">
                                <span th:text="${#numbers.formatDecimal(studio.pricePerHour, 0, 'POINT', 0, 'COMMA')}"></span>
                                <small class="fs-6 text-muted fw-normal">₫/h</small>
                            </h4>
                        </div>
                    </div>

                    <div class="card-footer bg-transparent border-0 pb-4 px-4">
                        <a th:href="@{/studio/{id}(id=${studio.id})}" class="btn btn-dark w-100 fw-bold rounded-pill py-2 shadow-sm">
                            Đặt lịch ngay <i class="bi bi-arrow-right-short ms-1 fs-5"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center mt-5" th:if="${totalPages > 1}">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm gap-2 border-0">
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                        <a class="page-link rounded-circle border-0 shadow-sm"
                           th:href="@{/home(page=${currentPage - 1}, keyword=${keyword})}">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                        th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link rounded-pill border-0 shadow-sm px-3"
                           th:href="@{/home(page=${i}, keyword=${keyword})}"
                           th:text="${i + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                        <a class="page-link rounded-circle border-0 shadow-sm"
                           th:href="@{/home(page=${currentPage + 1}, keyword=${keyword})}">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="bg-white py-5 border-top border-bottom mb-5">
        <div class="container py-4">
            <div class="row g-5">
                <div class="col-md-4">
                    <div class="p-4 bg-light service-box h-100 animate__animated animate__fadeIn">
                        <div class="bg-primary bg-opacity-10 text-primary p-3 rounded-4 d-inline-block mb-4 shadow-sm">
                            <i class="bi bi-soundwave fs-1"></i>
                        </div>
                        <h5 class="fw-bold text-dark">Âm thanh chuẩn</h5>
                        <p class="text-muted small mb-0">Trang thiết bị Micro, Preamp từ các hãng danh tiếng: Neumann, Genelec, Avalon.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 bg-light service-box h-100 animate__animated animate__fadeIn" style="animation-delay: 0.1s;">
                        <div class="bg-success bg-opacity-10 text-success p-3 rounded-4 d-inline-block mb-4 shadow-sm">
                            <i class="bi bi-calendar-check fs-1"></i>
                        </div>
                        <h5 class="fw-bold text-dark">Đặt lịch nhanh</h5>
                        <p class="text-muted small mb-0">Hệ thống thời gian thực giúp bạn chọn giờ và xác nhận chỉ trong 1 phút.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-4 bg-light service-box h-100 animate__animated animate__fadeIn" style="animation-delay: 0.2s;">
                        <div class="bg-warning bg-opacity-10 text-warning p-3 rounded-4 d-inline-block mb-4 shadow-sm">
                            <i class="bi bi-headphones fs-1"></i>
                        </div>
                        <h5 class="fw-bold text-dark">Kỹ thuật viên Pro</h5>
                        <p class="text-muted small mb-0">Hỗ trợ Mix & Master bởi những kỹ sư âm thanh giàu kinh nghiệm thực chiến.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5 pb-5" th:if="${posts != null && !posts.empty}">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <h3 class="fw-extrabold text-dark mb-0 text-uppercase">
                <i class="bi bi-newspaper text-danger me-2"></i>Tin tức âm nhạc
            </h3>
            <a th:href="@{/posts}" class="btn btn-outline-danger rounded-pill px-4 btn-sm fw-bold shadow-sm">
                Khám phá blog <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

        <div class="row g-4">
            <div class="col-md-4" th:each="post, iterStat : ${posts}" th:if="${iterStat.index < 3}">
                <a th:href="@{/post/{id}(id=${post.id})}" class="text-decoration-none text-dark h-100 d-block">
                    <div class="card border-0 shadow-sm h-100 studio-card">
                        <div class="overflow-hidden rounded-top-4 position-relative" style="height: 200px;">
                            <img th:src="${post.imageUrl != null ? post.imageUrl : 'https://placehold.co/600x400?text=News'}"
                                 class="card-img-top"
                                 onerror="this.src='https://placehold.co/600x400?text=NAT+Studio+News'">
                            <span class="badge bg-danger position-absolute top-0 start-0 m-3 shadow-sm">HOT</span>
                        </div>
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3 small text-muted">
                                <span class="fw-bold"><i class="bi bi-person-circle me-1"></i>Editor</span>
                                <span><i class="bi bi-calendar3 me-1"></i>[[${#temporals.format(post.createdAt, 'dd/MM/yyyy')}]]</span>
                            </div>
                            <h6 class="card-title fw-bold text-dark lh-base mb-3" th:text="${post.title}">Title</h6>
                            <p class="text-muted small mb-0"><i class="bi bi-book me-1"></i>Đọc chi tiết bài viết...</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/chat-box :: chat-box}"></div>

</body>
</html>